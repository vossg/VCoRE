CMAKE_MINIMUM_REQUIRED(VERSION 2.8)

PROJECT(VCoRE)

IF(NOT _OSGINITCACHELOADED AND EXISTS ${CMAKE_SOURCE_DIR}/CMakeCacheInitial.txt)
  GET_FILENAME_COMPONENT(_OSGTMPF "${CMAKE_SOURCE_DIR}/CMakeCacheInitial.txt" REALPATH)
  GET_FILENAME_COMPONENT(_OSGTMP  "${_OSGTMPF}" PATH)

  SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${_OSGTMP}")
  SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${_OSGTMP}/CMake")

  INCLUDE(${_OSGTMPF})
  SET(_OSGINITCACHELOADED TRUE CACHE INTERNAL "")
ENDIF(NOT _OSGINITCACHELOADED AND EXISTS ${CMAKE_SOURCE_DIR}/CMakeCacheInitial.txt)

SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${OpenSG_DIR}/share/OpenSG/cmake")

INCLUDE(OSGExternalProjectHelper)

SET(OSG_COMPONENTS OSGBase OSGSystem OSGState OSGGroup OSGDrawable OSGWindow
                   OSGText OSGUtil OSGWindowGLUT OSGFileIO OSGImageFileIO
                   OSGDynamics OSGContribCSM OSGEffectGroups OSGWindowQT4
                   OSGContribWebInterface)

LIST(APPEND OSG_OPTIONAL_COMPONENTS OSGWindowQT4)
LIST(APPEND OSG_OPTIONAL_COMPONENTS OSGContribWebInterface)

IF(UNIX)
  IF(APPLE)
    LIST(APPEND OSG_COMPONENTS OSGWindowCarbon)
  ELSE(APPLE)
    LIST(APPEND OSG_COMPONENTS OSGWindowX)
  ENDIF(APPLE)
ENDIF(UNIX)

IF(WIN32)
  LIST(APPEND OSG_COMPONENTS OSGWindowWIN32)
ENDIF(WIN32)

SET(OSG_PYTHON_MODULE_BASE_DIR "${CMAKE_SOURCE_DIR}/Bindings/Python" 
                               CACHE PATH "")

OSG_INIT(${OSG_COMPONENTS})

IF(WIN32)
  OSG_CONFIGURE_GLEW()
ENDIF(WIN32)

SET(OSG_BUILD_ACTIVE TRUE)

##############################################################################
# MAIN BUILD STEPS
##############################################################################

IF(OSG_ADDONS_ROOT AND EXISTS ${OSG_ADDONS_ROOT})

  SET(OSG_VCORE_ROOT ${CMAKE_SOURCE_DIR})
  SET(CFG_NAME "VCoRE")

  SET(OSG_COLLECT_LIST OSG_ADDONS_ROOT;FALSE;OSG_VCORE_ROOT;TRUE)

  OSG_DOCOLLECT_LIBS(${OSG_COLLECT_LIST})

ELSE()

  SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} 
                        "${OpenSGAddOns_DIR}/share/OpenSG/cmake")

  FIND_PACKAGE(OpenSGAddOns REQUIRED COMPONENTS OSGContribSOFA)

  INCLUDE(ConfigurePackages.OSGContribSOFA)

  IF(NOT OSG_BUILD_DEPENDEND)
    OSG_CONFIGURE_SOFA()
  ENDIF(NOT OSG_BUILD_DEPENDEND)

  IF(OSG_WITH_SOFA)
    IF(NOT OSG_BUILD_DEPENDEND)
      OSG_CONFIGURE_GLEW()
    ENDIF()
  ENDIF()

  LIST(APPEND OSG_ADDITIONAL_CONFIGURE_LINES "#cmakedefine OSG_WITH_SOFA 1")

  SET(_OSG_COMPONENTS ${_OSG_COMPONENTS} OSGContribSOFA)

  OSG_COLLECT_LIBS(TRUE)
ENDIF()

